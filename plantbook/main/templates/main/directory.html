{% extends 'main/base.html' %}
{% load static %}

{% block content %}

<main class="container">
    <div class="directory">
        <div class="section-header">
            <h1>User Directory</h1>
            <p>Find and connect with other plant enthusiasts</p>
        </div>

        <div class="directory-controls">
            <div class="search-box">
                <input type="text" id="userSearch" placeholder="Search users by name..." class="search-input">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="per-page-control">
                <label for="perPage">Users per page:</label>
                <select id="perPage" class="per-page-select">
                    <option value="12">12</option>
                    <option value="24">24</option>
                    <option value="36">36</option>
                    <option value="48">48</option>
                </select>
            </div>
        </div>

        <div id="usersGrid" class="users-grid">
            {% for user in users %}
                <div class="user-card">
                    <a href="{% url 'main:user_profile' user.id %}" class="user-link">
                        {% if user.profile.profile_photo %}
                            <img src="{{ user.profile.profile_photo.url }}" alt="{{ user.get_full_name|default:user.email }}" class="user-photo">
                        {% else %}
                            <div class="user-photo-placeholder">
                                <i class="fas fa-user-circle"></i>
                            </div>
                        {% endif %}
                        <div class="user-info">
                            <h3>{{ user.get_full_name|default:user.email }}</h3>
                            <p class="plant-count">{{ user.plant_count }} plants</p>
                        </div>
                    </a>
                </div>
            {% endfor %}
        </div>

        <div id="pagination" class="pagination">
            {% if users.has_previous %}
                <a href="?page=1" class="page-link">&laquo; First</a>
                <a href="?page={{ users.previous_page_number }}" class="page-link">Previous</a>
            {% endif %}

            <span class="current-page">
                Page {{ users.number }} of {{ users.paginator.num_pages }}
            </span>

            {% if users.has_next %}
                <a href="?page={{ users.next_page_number }}" class="page-link">Next</a>
                <a href="?page={{ users.paginator.num_pages }}" class="page-link">Last &raquo;</a>
            {% endif %}
        </div>
    </div>
</main>

<style>
.directory {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    padding: 2rem;
    margin-top: 1rem;
}

.section-header {
    text-align: center;
    margin-bottom: 2rem;
}

.section-header h1 {
    color: #4CAF50;
    margin-bottom: 0.5rem;
}

.section-header p {
    color: #666;
    font-size: 1.1rem;
}

.directory-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    gap: 1rem;
}

.search-box {
    position: relative;
    flex: 1;
    max-width: 400px;
}

.search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.5rem;
    border: 1px solid #ddd;
    border-radius: 25px;
    font-size: 1rem;
    transition: all 0.2s;
}

.search-input:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.per-page-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.per-page-select {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9rem;
}

.users-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.user-card {
    background: #f8f8f8;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: transform 0.2s;
}

.user-card:hover {
    transform: translateY(-5px);
}

.user-link {
    text-decoration: none;
    color: inherit;
    display: block;
}

.user-photo {
    width: 100%;
    height: 200px;
    object-fit: cover;
}

.user-photo-placeholder {
    width: 100%;
    height: 200px;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #4CAF50;
    font-size: 3rem;
}

.user-info {
    padding: 1rem;
    text-align: center;
}

.user-info h3 {
    margin: 0;
    color: #333;
    font-size: 1.1rem;
}

.plant-count {
    color: #666;
    font-size: 0.9rem;
    margin: 0.5rem 0 0;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 2rem;
}

.page-link {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    color: #333;
    text-decoration: none;
    transition: all 0.2s;
}

.page-link:hover {
    background: #f5f5f5;
    border-color: #4CAF50;
    color: #4CAF50;
}

.current-page {
    padding: 0.5rem 1rem;
    color: #666;
}

@media (max-width: 768px) {
    .directory {
        padding: 1rem;
    }

    .directory-controls {
        flex-direction: column;
        align-items: stretch;
    }

    .search-box {
        max-width: none;
    }

    .users-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('userSearch');
    const perPageSelect = document.getElementById('perPage');
    const usersGrid = document.getElementById('usersGrid');
    const pagination = document.getElementById('pagination');
    let searchTimeout;

    function updateUsers(searchQuery = '', page = 1) {
        const perPage = perPageSelect.value;
        const url = `/directory/?q=${encodeURIComponent(searchQuery)}&page=${page}&per_page=${perPage}`;
        
        fetch(url)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                usersGrid.innerHTML = doc.getElementById('usersGrid').innerHTML;
                pagination.innerHTML = doc.getElementById('pagination').innerHTML;
            })
            .catch(error => console.error('Error:', error));
    }

    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            updateUsers(this.value);
        }, 300);
    });

    perPageSelect.addEventListener('change', function() {
        updateUsers(searchInput.value);
    });

    // Handle pagination clicks
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('page-link')) {
            e.preventDefault();
            const page = new URL(e.target.href).searchParams.get('page');
            updateUsers(searchInput.value, page);
        }
    });
});
</script>
{% endblock %} 